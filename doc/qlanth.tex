\documentclass{article} 
\usepackage[utf8]{inputenc}
\usepackage[paperwidth=8.5in,paperheight=11in]{geometry}
%\usepackage[paperwidth=8.5in,paperheight=14.2885in]{geometry}
\geometry{left=2cm, right=2cm, top=2cm, bottom=2cm}
% Include the listings package for syntax highlighting
\usepackage{listingsutf8}
% Optional: include the xcolor package for more advanced color definitions
\usepackage[dvipsnames]{xcolor} 
\usepackage{multicol}  
\usepackage{amssymb,
			amsmath} 
\usepackage{dutchcal}
\usepackage{qlanth} 
% \usepackage{qlanthextras}
\usepackage{scalerel}
\usepackage{mdframed}
\usepackage{pgffor}
\usepackage{lmodern}
\usepackage[htt]{hyphenat} %Enable hythenation of TT text:
\usepackage[backend=bibtex,style=alphabetic]{biblatex}
\addbibresource{qlanth.bib} 
\newcommand{\codetext}[1]{{\color{BlueViolet} \texttt{#1}}} 
% Listing configuration
\lstset{   
    language=Mathematica,                   % Set your language (you can change the language for each code-block optionally)
    basicstyle=\ttfamily\small,       % The size of the fonts that are used for the code
    literate=
        {\\[Alpha]}{{$\alpha$}}{1}
        {\\[Beta]}{{$\beta$}}{1}
        {\\[Gamma]}{{$\gamma$}}{1}
        {\\[Zeta]}{{$\zeta$}}{1}
        {\\[VerticalSeparator]}{|}{1}
        ,  
    keywordstyle=\color{blue},        % Keyword style
    stringstyle=\color{OliveGreen},        % String literal style
    commentstyle=\color{cyan},        % Comment style
    morecomment=[l][\color{magenta}]{\#},
    breakatwhitespace=false,          % Sets if automatic breaks should only happen at whitespace
    breaklines=true,                  % Sets automatic line breaking
    captionpos=b,                     % Sets the caption-position to bottom
    keepspaces=true,                  % Keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
    showspaces=false,                 % Show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
    showstringspaces=false,           % Underline spaces within strings only
    showtabs=false,                   % Show tabs within strings adding particular underscores
    tabsize=2,                        % Sets default tabsize to 2 spaces
    frame=single,                     % Adds a frame around the code
    numbers=left,                     % Where to put the line-numbers; possible values are (none, left, right)
    numberstyle=\tiny\color{gray},    % Style used for line-numbers
    stepnumber=1,                     % Step between two line-numbers. If it's 1, each line will be numbered
    numbersep=5pt,                    % How far the line-numbers are from the code
    xleftmargin=0.8cm,                % Margin from left
    xrightmargin=0cm              % Margin from right
}
\usepackage[colorlinks=true, citecolor=blue, linkcolor=blue, urlcolor=cyan]{hyperref}

\begin{document} 

\begin{titlepage} % Start of the title page
    \centering
    \vspace*{\fill}
    
    % Include the image
    \includegraphics[width=0.6\textwidth]{ion_in_lattice.jpg} % Adjust the size as needed
    \vspace*{1cm} % More vertical space
    
    % Software name
    {\Large\qlanth}\\
    \vspace*{0.5cm}
    {\large version $\ket{\alpha}^{(2)}$}\\
    \vspace*{2cm}
    
    % Additional information
    {\large Juan David Lizarazo Ferro}\\
    {\large \& Christopher Dodson}\\
    \vspace{0.5cm}
    {\large Under the advisory of Dr. Rashid Zia}\\
    \vspace*{\fill}
\end{titlepage}

\newpage

\

\newpage


\vspace*{\fill}

\tableofcontents

\vspace*{\fill}

\newpage

\vspace*{\fill}



\qlanth is a Mathematica package that can be used to estimate the level structure of lanthanide ions embedded in crystals. For this purpose it uses a single configuration description and a corresponding effective Hamiltonian. This Hamiltonian aims to describe the observed properties of ions embedded in solids in a picture that imagines them as free-ions but modified by the influence of the lattice in which they find themselves in.

This picture is one that developed and mostly matured in the second half of the last century by the efforts of Giulio Racah, Brian Judd, Hannah Crosswhite, Robert Cowan, Michael Reid, Bill Carnall, Clyde Morrison, Brian Wybourne, and Katherine Rajnak among others. The goal of this code is to provide a modern implementation of the methods that resulted from their work.

\qlanth also includes data that might be of use to those interested in the single-configuration description of lanthanide ions, separate to their specific use in this code. These data include the coefficients of fractional parentage (as calculated by Velkov and parsed here), and reduced matrix elements for all the operators in the effective Hamiltonian. These are provided as standard Mathematica associations that should be simple to port elsewhere.

The included Mathematica notebook \codetext{qlanth.nb} has examples of the capabilities that this package offers, and the \codetext{/examples} folder includes a series of notebooks for most of the trivalent lanthanide ions in lanthanum fluoride. LaF3 is remarkable in that it was one of the systems in which a systematic study \cite{carnall_systematic_1989} of all of the trivalent lanthanide ions were studied. 

This code was originally authored by Christopher Dodson and Rashid Zia and has been modified and rewritten by David Lizarazo. It has benefited from conversations with Tharnier Puel at the University of Iowa.

This document has 11 sections. In the first section the basis in which the Hamiltonian is evaluated is explained. In the second section a brief explanation of the coefficients of fractional parentage is given. Afther that the third section explains how the Hamiltonian is put together by first having calculated JJ' blocks.

The four section is dedicated to a theoretical exposition of the effective Hamiltonian with subsections for each of the terms that it contains. Section 5 is about the calculation of magnetic dipole transitions.

Sections 6 and 7 list additional data included in \qlanth. While section 8 has a brief comment on units. 

Section 9 includes a brief of notation use throught this document and section 11 prints out the code included in \qlanth.


\section{The $\LSJMbasis$ Basis}

The basis used in \qlanth is the $\LSJMbasis$ basis. As such the basis vectors are common eigenvectors of the operators $\op{L}^2$, $\op{S}^2$, $\op{J}^2$, and $\op{J}_z$. The LS terms allowed in each configuration $\forb^\numE$ are obtained from tables that originate from the orginal work by Nielson and Koster \cite{nielson_spectroscopic_1963}. In \qlanth these are parsed from the file \codetext{B1F\_ALL.TXT} which is part of the doctoral research of Dobromir Velkov \cite{velkov_multi-electron_2000} in which he recomputed coefficients of fractional parentage under the advisory of Brian Judd. 

One of the facts that have to be accounted for in a basis that uses L and S as quantum numbers, is that there might be several linearly independent path to couple the electron spin and orbital momenta to add up to given total $L$ and total $S$. For this reason additional labels are necessary to distinguish between these different terms. The simplest way of doing this dates back to the tables of Nielson and Koster \cite{nielson_spectroscopic_1963}, and consists in assigning consecutive integers to degenerate LS terms, with no specific role given to them, except that of discriminating between different degenerate terms. It is also possible to add more useful labels that reflect additional symmetries that the f-electron wavefunctions find in the groups $\SO{7}$ and $\text{G}_2$.

The following are all the LS terms in the $\forb^{\numE}$ configurations. In the notation used the superscript index before the letter notes the spin multiplicity $2S+1$, the roman letter indicating the value of $L$ in spectroscopic notation, and the final integer (if present) is the label that discriminates between several degenerate LS. This index we frequently label in the equations contained in this document with the greek letter $\alpha$.


\input{fnTerms.tex}   
 
In \qlanth these terms may be queried through the function \codetext{AllowedNKSLTerms}. 

\foreach \name in {AllowedNKSLTerms}{ 
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }

The LS quantum numbers, however, only get us half-way to the $\LSJMbasis$ basis. For the $J$ quantum number corresponding to total angular momentum, adding $L$ and $S$ can have values ranging from $\abs{L-S}$ to $\abs{L+S}$. Finally, for each of these values of $J$ there are then $2J+1$ projections on the z-axis for the possible values of $\Msub{J}$. For instance, the ordered $\LSJMbasis$ basis for $\forb^2$ is the one below.
 
\input{f2BasisbyJ.tex} 

The order above is exemplar of order in the bases. Notice how the basis vectors are sorted in order of increasing $J$, so that for instance not all of the basis kets associated with the $\LSterm{3}{P}$ LS term are contiguous.

In \qlanth the ordered basis used for a given $\forb^\numE$ is provided by \codetext{BasisLSJMJ}. 

\lstinputlisting[language=Mathematica]{./fundefs/BasisLSJMJ.tex}

\section{The coefficients of fractional parentage}

In the 1920s and 1930s when the spectroscopic evidence was being put together to ellucidate the principles of quantum mechanics, one of the conceptual tools that was put forward for the analysis of the complex spectra of ions \cite{bacher_atomic_1934} consisted in using the spectrum of an ion at a lower stage of ionization to understand a higher stage of ionization. For instance, using the fourth spectrum of oxygen (OIV) in order to understand the third spectrum (OIII) of the same element. 

This idea matured a couple of decades until the work of Giulio Racah made it mathematically precise. Racah clarified the way in which the wavefunctions from configuration $\forb^{\numE-1}$ can be used to build up the wavefunction of configuration $\forb^{\numE}$, as a ``sum over parents''
\begin{equation}
\ket{\lorb^\numE \alpha LS} = 
	\sum_{\bar{\alpha}\bar{L}
		\bar{S}} 
		\underbracket{\cfp{\lorb^{\numE-1}\bar{\alpha}\bar{L}\bar{S}}
			{\lorb^{\numE}\alpha{LS}}}_
		{\substack{
            \text{How much of parent }\ket{\lorb^{\numE-1}\bar{\alpha}\bar{L}\bar{S}} \\
            \text{is in daughter}\ket{\lorb^{\numE}{\alpha}{L}{S}}
            }
        }
		\underbracket{\ket{\left(\lorb^{\numE-1}\bar{\alpha}\bar{L}\bar{S},\lorb\right)LS}}_
		{\substack{
            \text{Couple an additional $\lorb$} \\
            \text{to the parent }\ket{\lorb^{\numE-1}\bar{\alpha}\bar{L}\bar{S}}
            }
        }.
\end{equation}

Most importantly for us, in \qlanth the coefficients of fractional parentage can be used to evaluate matrix elements of operators, such as in \eqnref{eqn:reducedV1k}, \eqnref{eqn:three body escalator}, \eqnref{eqn:ReducedUk}, and \eqnref{double cfp escalator}. These formulas realize a convenient calculational advantage: if one knows matrix elements in one configuration, then one can immediately calculate them in any other configuration.

In principle all the data that is needed in order to evaluate the matrix elements that \qlanth uses can all be derived from coefficients of fractional parentage, tables of 6j and 3j coefficients, and the LSUW labels for the terms in the $\forb^{\numE}$ configurations.

The data for the coefficients of fractional parentage we owe to \cite{velkov_multi-electron_2000} from which the file \codetext{B1F\_all.txt} originates, and which we use here to extract this useful ``escalator'' up the $\forb^{\numE}$ configurations.

In \qlanth the function \codetext{GenerateCFPTable} is used to parse the data contained in this file. From this data an association \codetext{CFP} is generated, whose keys are made to represent LS terms from a configuration $\forb^{\numE}$ and whose values are list which contain all the parents terms, together with the corresponding coefficients of fractional parentage.

\section{The JJ' block structure}

Now that we know how the bases are ordered, we can already understand the structure of how the final Hamiltonian matrix representation in the $\LSJMbasis$ basis is put together.

For a given configuration $\forb^\numE$ and for each term $\op{\mathcal{h}}$ in the Hamiltonian, \qlanth first calculates the matrix elements $\braopket{\alpha L S J \Msub{J}}{\op{\mathcal{h}}}{\alpha' L' S' J' \Msub{J}'}$ so that for each interaction an association with keys of the form $\{J, J'\}$ are created. The values being rectangular rank-2 arrays.

\figuref{JJ blocks} shows roughly this block structure for $\forb^2$. In that figure the shape of the rectangular blocks is determined by the fact that for $J=0,1,2,3,4,5,6$ there are (2, 3, 15, 7, 27, 11, 26) corresponding basis states. As such, for example, the first row of blocks consists of blocks of size $(2\times{2})$, $(2\times{3})$, $(2\times{15})$, $(2\times{7})$, $(2\times{27})$, $(2\times{11})$, and $(2\times{26})$.

\begin{figure}[h!]
\begin{center}
	\includegraphics{blockStruct.pdf}
\end{center}
\caption{The JJ block structure for $\forb^2$}
\label{JJ blocks}
\end{figure}

In \qlanth these blocks are put together by the function \codetext{JJBlockMatrix} which adds together the contributions from the different terms in the Hamiltonian.

\lstinputlisting[language=Mathematica]{./fundefs/JJBlockMatrix.tex}

Once these blocks have been calculated and saved to disk (in the folder \codetext{./hams/}) the function \codetext{HamMatrixAssembly} takes them, assembles the arrays in block form, and finally flattens it to provide a rank-2 array. This are the arrays that are finally diagonalized to find energies and eigenstates.

\lstinputlisting[language=Mathematica]{./fundefs/HamMatrixAssembly.tex}

\section{The effective Hamiltonian} 

Electrons in a multi-electron ion are subject to several interactions. Firstly, they are attracted to the nucleus around which they orbit. Additionally, they experience repulsion from other electrons. Electrons also possess spin, subjecting them to various magnetic interactions. The spin of each electron interacts with the magnetic field generated by either its own orbital angular momentum or that of another electron. Finally, among pairs of electrons, the spin of one can influence the other through the interaction of their respective magnetic dipoles.

This framework sufficiently describes the interactions within a free ion. However, to extend this model to ions within a crystal, we must incorporate the effects of the crystal field. This is often achieved by considering the electric field that an ion experiences from the surrounding charges in the crystal lattice, a concept referred to as the crystal field effect.

The Hilbert space of a multi-electron ion is a vast stage. In principle the Hilbert space should have a countable infinity of discrete states and a uncountable infinity of states to describe the unbound states. This is clearly too much to handle, but thankfully, this large stage can be put in some order thanks to the exclusion principle. The exclusion principle (together with that graceful tendency of things to drift downwards the energetic wells) provides the shell structure. This shell structure, in turn, makes it possible that an atom with many electrons, can be described effectively as an aggregate of an inert core, and a fewer active valence electrons.  

Take for instance a triply ionized neodymium atom. In principle, this gives us the daunting task of dealing with 57 electrons. However, 54 of them arrange themselves in a xenon core, so that we are only left to deal with only three. Three are still a challenging task, but much less so than fifty seven. Furthermore, the exclusion principle also guides us in what type of orbital we could possibly place these three electrons, in the case of the lanthanide ions, this being the 4f orbitals. But not really, there are many more unoccupied orbitals outside of the xenon core, two of these electrons, if they are willing to pay the energetic price, they could find themselves in a 5d or a 6s orbital.  

Here we shall assume a single-configuration description. Meaning that all the valence electrons in the ions that we study here will all be considered to be located in f-orbitals, or what is the same, that they are described by \fn wavefunctions. This is, however, a harsh approximation, but thankfully one can make some amends to it. The effects that arise in the single configuration description because of omitting all the other possible orbitals where the electrons might find themselves, this is what we call \textit{configuration interaction} or CI for short. 

These effects can be brought within the simplified description only through the help of perturbation theory. The task not the usual one of correcting for the energies/eigenvectors given an added perturbation, but rather to consider the effects of using a truncated Hilbert space due to a known interaction. For a detailed analysis of this see Rudzikas' \cite{rudzikas_theoretical_2007} book on theoretical atomic spectroscopy or this article by Lindgren \cite{lindgren_rayleigh-schrodinger_1974}. What results from this are operators that now act solely within the single configuration but with a convoluted coefficient that depends on overlap integrals between different configurations. These coefficients one could try to evaluate, and there are some that have trodden this road. Others simply label that complex expression with an unassuming symbol, and leave it as a parameter that one can hope to fit against experimental data. It is from CI that the parameters $\casimirAlpha, \casimirBeta, \casimirGamma, \Pk{k}, \Tk{k}$ enter into the description.

Something that is also borne out of the configuration interaction analysis is that their influence also modifies previously present intra-configuration operators. For instance, part of the configuration interaction influence that results from the Coulomb repulsion between electrons brings about new operators that need to be included, but they also contribute to the intra-configuration Slater integrals.

When finding the matrix elements of the Hamiltonian defined by these terms, one also requires the specification of the basis in which the matrix elements will be computed. What we shall use here are states determined by five quantum numbers: the total orbital angular momentum $L$, the total spin angular momentum $S$, the total angular momentum $J$, and the projection of the total angular momentum along the z-axis $M_J$. To account for the fact that there might be a few different ways to amount for a given LS, it becomes necessary to have a fifth quantum number that discriminates between these different cases. This other quantum number we shall simply call $\alpha$, which in the notation of Nielson and Koster is simply an integer number that enumerates all the possible LS in a given \fn configuration.

Putting all of this together leads to the following Hamiltonian. In there, ``v-electrons'' is shorthand for valence electrons.

\begin{mdframed}
\begin{align} 
	\ham &= \underbracket{\hamKineticSymbol}_{\text{kinetic}}
		 + \underbracket{\hamNuclearCoulombSymbol}_{\text{e:shielded nuc}}
		 + \underbracket{\hamCoulombEESymbol}_{\text{e:e}}
		 + \underbracket{\hamSpinOrbitSymbol}_{\text{spin-orbit}}
		 + \underbracket{\hamSpinSpinSymbol}_{
		 			\substack{
		 				\text{spin:spin} \\ 
		 				\text{and spin:other-orbit}
		 				}
		 			} 
         + \underbracket{\hamSOOplusECSOSymbol}_{
            \substack{
                \text{spin:other-orbit} \\ 
                \text{ec-correlated-spin:orbit}
                }
         } + \\
         & \underbracket{\hamTreesSymbol}_\text{Trees effective op} 
		 + \underbracket{\hamGTwoSymbol}_\text{G${}_2$ effective op} 
		 + \underbracket{\hamSOSevenSymbol}_\text{$\SO{7}$ effective op} 
		 + \underbracket{\ham_{\trispoke}}_{\substack{
            \text{effective} \\
            \text{three-body}}}
         + \underbracket{\hamCrystalFieldSymbol}_{\text{crystal field}} 
         + \underbracket{\hamZeemanSymbol}_{\text{Zeeman}} \\
	\hamKineticSymbol &= -\frac{\hbar^2}{2m_e}\sum_{i=1}^\numE \nabla_i^2 \text{ (kinetic energy of $\numE$ v-electrons)}\\
	\hamNuclearCoulombSymbol &= \hamNuclearCoulomb \text{ (interaction of v-electrons with shielded nuclear charge)} \\
	\ham_\text{e:e} &= \hamCoulombEE \text{ (v-electron:v-electron repulsion)} \\  
	\hamSpinOrbitSymbol &= \begin{cases} 
			\hamSpinOrbit \text{ with } \xi{(r_i)} = \frac{\hbar^2}{2 m^2 c^2 r_i} \frac{\diff{V_\text{sn}(r_i)}}{\diff{r_i}} \\
			\sum_{i=1}^\numE \spinZeta \paren{\op{\sspin}_i \cdot \op{\lorb}_i} {{\substack{
						\text{ with $\spinZeta$ the radial average of $\xi(r_i)$} \\ 
						\text{ or used as phenomenological parameter}  
						}
					}}    
			\end{cases} \\    
	\hamSpinSpinSymbol &= \hamSpinSpin \\  
	\hamSOOplusECSOSymbol &= \hamSOOplusECSO \\ 
	\nonumber \casimir{\anyGroup} &\DEF \text{The Casimir operator of group $\anyGroup$.}\\ 
	\hamTreesSymbol &= \casimirAlpha\casimir{\mathbb{R}^3} = \casimirAlpha \op{L}^2 \text{ (Trees effective operator)} \\
	\hamGTwoSymbol      &= \casimirBeta\casimir{\text{G}_2} \\
	\hamSOSevenSymbol   &= \casimirGamma\casimir{\SO{7}} \\
	\ham_{\trispoke} &= {\opcolor{T'^{(2)}}}t'_2 + \hamEffectiveThreeBody \text{ (effective 3-body operators $\op{t}_k$)} \\
	\hamCrystalFieldSymbol &= \hamCrystalField {   
		\substack{
			\text{ (crystal field interaction of v-electrons with} \\
			\text{electrostatic field due to surroundings)}
			} 
			}\\
    \hamZeemanSymbol &= -\vec{B} \cdot \op{\mu} = \hamZeeman \text{(interaction with a magnetic field)}
\label{The very effective Hamiltonian}
\end{align}  
\end{mdframed}

It is of some importance to note that the eigenstates that we'll end up with have shoved under the rug all the radial dependence of the wavefunctions. This dependence has been already integrated in the parameters that the Hamiltonian has. 

\subsection{$\hamKineticSymbol$: kinetic energy}

    \begin{equation}
        \hamKineticSymbol = -\frac{\hbar^2}{2m}\sum_{i=1}^N \nabla_i^2 \text{ (kinetic energy of N v-electrons)}
    \end{equation}

    Within the basis that we'll use, the kinetic energy simply contributes a constant energy shift, and since all we care about are energy differences, then this term can be omitted from the analysis.
    
    There is one way in which this term does influence the analysis, which is that for the lanthanide ions, this term certainly makes relativistic corrections a meanigful concern. In the \textit{trivalent} lanthanide ions that are often considered, each electron in a \textit{4f} has a kinetic energy of $10  \,\eV$ which in the energy units we use here is about $10^6 \text{K}$ and which corresponds to a speed of about $1\%$ the speed of light.

\subsection{$\hamNuclearCoulombSymbol$: the central field potential}

	In principle the sum over the Coulomb potential should extend over the nuclear charge and over all the electrons in the atom (not just the valence electrons). However, given the shell structure of the atom, the lanthanide ions ``see'' the nuclear charge as shielded by a xenon core. Since every closed shell is a singlet, having spherical symmetry, these shields are literally like spherical shells surrounding the nucleus.
    \begin{equation}
    \hamNuclearCoulombSymbol = -e^2 \sum_{i=1}^{Z} \frac{1}{r_{i}} + e^2 \underbracket{\sum_{i=1}^{\numE}\sum_{j=1}^{Z-\numE} \frac{1}{r_{ij}}}_{\substack{
            \text{Repulsion be-} \\
            \text{tween valence} \\
            \text{and inner shell} \\
            \text{electrons} 
            }
          } \approx \sum_{i=1}^\numE V_\text{sn}(r_i) \text{ (with Z = atomic No.)}
    \end{equation}
	The precise form of $V_\text{sn}(r_i)$ is not of our concern here, all that matters is that we assume that it is spherically symmetric so that we can justify the separation of radial and angular parts to the wavefunctions.

\subsection{$\hamCoulombEESymbol$: e:e repulsion}
 
    \begin{equation}
        \hamCoulombEESymbol = \hamCoulombEE = \sum_{k=0,1,2,3} \Ek \hat{e}^k 
    \end{equation}  

    This term is the first we will not discard. Calculating this term for the \fn configurations was one of the contribution from Slater, as such the parameters we use to write it up are called \textit{Slater integrals}. After the analysis from Slater, Giulio Racah contributed further to the analysis of this term. The insight that Racah had was that if in a given operator one identified the parts in it that transformed nicely according to the different symmetry groups present in the problem, then calculating the necessary matrix element in all \fn configurations can   be greatly simplified.

    The functions used in \ql to compute these LS-reduced matrix elements are \codetext{Electrostatic} and \codetext{fsubk}. In addition to these, the LS-reduced matrix elements of the tensor operators $\op{C}^{(k)}$ and $\op{U}^{(k)}$ are also needed. These functions are based in equations 12.16 and 12.17 from \cite{cowan_theory_1981} as specialized for the case of electrons belonging to a single \fn configuration. By default this term is computed in terms of $\Fk$ Slater integrals, but it can also be computed in of the $\Ek$ Racah parameters, the functions \codetext{EtoF} and \codetext{FtoE} instrumental for going from one representation to the other.
    
    \begin{equation}
    \redbraopket{\forb^n\alpha\LSterm{2S+1}{L}}
        {\hamCoulombEESymbol}
        {\forb^n\alpha'\LSterm{2S'+1}{L'}} = \sum_{k=0,2,4,6} \Fk f_k(n,\alpha{LS},\alpha'{L'S'})
    \end{equation} 
    where
    \begin{multline}
        f_k(n,\alpha{LS},\alpha'{L'S'}) = \frac{1}{2} 
            \kronecker{S}{S'}
            \kronecker{L}{L'}
            \redbraopket{\forb}
                {\op{\mathcal{C}}^{(k)}}
                {\forb}^2 \times \\
            \left\{ 
                \frac{1}{\tpo{L}} \sum_{\alpha''L''} 
                    \redbraopket{\forb^\numE \alpha'' L'' S}
                        {\op{U}^{(k)}}
                        {\forb^\numE \alpha L S} 
                \redbraopket{\forb^\numE \alpha'' L'' S}
                    {\op{U}^{(k)}} 
                    {\forb^\numE \alpha' L S}
                - \kronecker{\alpha}{\alpha'}
                    \frac{\numE \left(4 \forb + 2 - \numE\right)}
                        {(\tpo{\forb})(4 \forb + 1)} 
            \right\}
    \end{multline}       

	\foreach \name in {Electrostatic, fsubk, EtoF, FtoE}{ 
	        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
	    }

\subsection{$\hamSpinOrbitSymbol$: spin-orbit}

	The spin-orbit interaction arises from the interaction of the magnetic moment of the electron and the magnetic field that its orbital motion generates. In terms of the central potential $V_{\text{s:n}}$ the spin-orbit term for a single electron is
    \begin{equation}
        \hat{\mathcal{h}}_{\text{s:o}} = \frac{\hbar^2}{2\me^2 c^2} \left(\frac{1}{r}\frac{\mathrm{d}V_{\text{s:n}}}{\mathrm{d}r}\right)\op{l}\cdot{\op{s}} \DEF \zeta{(r)} \op{l}\cdot\op{s}.
    \end{equation}
    Adding this term for all the $\numE$ valence electrons, and replacing $\zeta(r)$ by it's radial average $\spinZeta$ then gives
    \begin{equation}
    \hamSpinOrbitSymbol = \sum_i^{\numE} \spinZeta \dotp{\op{l}_i}{\op{s}_i}.
    \end{equation}

    From equations 2-106 to 2-109 in Wybourne \cite{wybourne_electrostatic_1963} the matrix elements we need are given by
    \begin{multline} 
        \braopket{\alpha LSJ \Msub{J} }{\hamSpinOrbitSymbol}{\alpha' L'S'J'\Msub{J'}} = 
        \spinZeta
        \kronecker{J}{J'}
        \kronecker{\Msub{J}}{\Msub{J'}}
        \braopket{\alpha LSJ \Msub{J} }{\sum_i^{\numE} \dotp{\op{l}_i}{\op{s}_i}}{\alpha' L'S'J\Msub{J}} \\ 
        = \spinZeta \kronecker{J}{J'}
        \kronecker{\Msub{J}}{\Msub{J'}} \phaser{J+L+S'} 
            \sixj{L}{L'}{1}{S'}{S}{J} 
            \braopket{\alpha LS}{\sum_i^{\numE} \dotp{\op{l}_i}{\op{s}_i}}{\alpha' L'S'} \\
        = \spinZeta \kronecker{J}{J'}
        \kronecker{\Msub{J}}{\Msub{J'}} \phaser{J+L+S'} 
            \sixj{L}{L'}{1}{S'}{S}{J} 
            \sqrt{\lorb (\lorb + 1)(2\lorb + 1)} 
            \redbraopket{\alpha{LS}}{\op{V}^{(11)}}{\alpha'L'S'}.
    \end{multline}

    Where $\hat{V}^{(11)}$ is a double tensor operator of rank one over spin and orbital parts defined as 
    \begin{equation}
        \op{V}^{(11)} = \sum_{i=1}^\numE \left( \op{s}\op{u}^{(1)} \right)_i,
    \end{equation}
    where the rank on the spin operator $\op{s}$ has been omitted, and the rank of the orbital tensor operator explicitly as 1.

    In \qlanth the reduced matrix elements for this double tensor operator are calculated by \codetext{ReducedV1k} and aggregated in a static association called \codetext{ReducedV1kTable}. The reduced matrix elements of this operator are calculated using equation 2-101 from Wybourne \cite{wybourne_spectroscopic_1965}:
    \begin{multline} 
        \redbraopket{\lorb^\numE \psi}{\op{V}^{(1k)}}{\lorb^\numE \psi'} = 
            \redbraopket{\lorb^\numE \alpha L S}
                {\op{V}^{(1k)}}
                {\lorb^\numE \alpha'L'S'} =
            \numE 
                \sqrt{\sspin (\sspin + 1) (2\sspin + 1)}
                \sqrt{\tpobraket{S}\tpobraket{L}\tpobraket{S'}\tpobraket{L'}} \times \\
        \sum_{\bar{\psi}}
            \phaser{\bar{S} + \bar{L} + S + L + \lorb + \sspin + k + 1}
            \cfpinv{\psi}{\bar{\psi}}
            \cfp{\bar{\psi}}{\psi'}
            \sixj{S}     {S'}     {1}
                {\sspin} {\sspin} {\bar{S}}
            \sixj{L}     {L'}    {k}
                {\lorb} {\lorb} {\bar{L}}
    \label{eqn:reducedV1k}
    \end{multline}

    In this expression the sum over $\bar{\psi}$ depends on $(\psi,\psi')$ and is over all the states in $\lorb^{n-1}$ which are common parents to both $\psi$ and $\psi'$. Also note that in the equation above, since our concern are f-electron configurations, we have $\lorb = 3$ and $\sspin = \frac{1}{2}$ as is due to the electron.

\foreach \name in {ReducedV1k}{ 
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }
 
	These reduced matrix elements are then used by the function \codetext{SpinOrbit}.

\foreach \name in {SpinOrbit}{ 
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    } 
 
\subsection{$\hamTreesSymbol, \hamGTwoSymbol, \hamSOSevenSymbol$: electrostatic configuration interaction}

    This is a first term where we take into account the very important contributions from configuration interaction. When the interaction with configurations ?? and ?? it was realized that the way the omission of these configurations in the single configuration description was to relax the previous restriction that $\Fk$ should only have even values for k. Parallel to this Trees noticed an interesting fact which is that a fair amount of correction to the calculated spectrum of would benefit if one added to all of the LS energies a term quadratic in L. Soon after this it was acknowledged that the inclusion of odd $\Fk$ was equivalent to adding three terms related to the Casimir operators of the groups $\SO(3)$, $\text{G}_2$, and $\SO(7)$ \cite{wybourne_electrostatic_1963}. In addition to this, the configuration interaction analysis, also showed that the contributions from other configuration would also overlap with the already present even $\Fk$.

    One of these Casimir operators is the familiar $\op{L}^2$ from $\SO{3}$. In analogy to $\op{L}^2$ in which the quantum number $L$ can be used to determine the eigenvalues, in the cases of $\hamGTwoSymbol$ the necessary state label is the $U$ label of the $LS$ term, and in the case of $\hamSOSevenSymbol$ the necessary label is $W$. If $\Lambda_{\text{G}_2}\!(U)$ is used to note the eigenvalue of the Casimir operator of $\text{G}_2$ corresponding to label $U$, and $\Lambda_{\SO{7}}\!(W)$ the eigenvalue corresponding to state label $W$, then the matrix elements of $\hamTreesSymbol$, $\hamGTwoSymbol$ and $\hamSOSevenSymbol$ are diagonal in all quantum numbers and are given by
    \begin{align}
        \braopket{\lorb^\numE \alpha S L J \Msub{J}}
            {\hamTreesSymbol}
            {\lorb^\numE \alpha' S' L' J' \Msub{J}'} &=
            \casimirAlpha
            \kronecker{\alpha{SLJ}\Msub{J}}{\alpha'{S'L'J'}\Msub{J}'}
            L(L+1) \\
        \braopket{\lorb^\numE U \alpha S L J \Msub{J}}
            {\hamGTwoSymbol}
            {\lorb^\numE U \alpha' S' L' J' \Msub{J}'} &=
            \casimirBeta
            \kronecker{\alpha{SLJ}\Msub{J}}{\alpha'{S'L'J'}\Msub{J}'}
            \Lambda_{\text{G}_2}\!(U) \\
        \braopket{\lorb^\numE W \alpha S L J \Msub{J}}
            {\hamSOSevenSymbol}
            {\lorb^\numE W \alpha' S' L' J' \Msub{J}} &=
            \casimirGamma
            \kronecker{\alpha{SLJ}\Msub{J}}{\alpha'{S'L'J'}\Msub{J}'}
            \Lambda_{\SO{7}}\!(W)
    \end{align}

    In \qlanth the role of $\Lambda_{\SO{7}}\!(W)$ is played by the function \codetext{GSO7W}, the role of $\Lambda_{\text{G}_2}\!(U)$ by \codetext{GG2U}, and the role of  $\Lambda_{\SO{3}}\!(L)$ by \codetext{CasimirSO3}. These are used by \codetext{CasimirG2}, \codetext{CasimirSO3}, and \codetext{CasimirSO7} which find the corresponding ${U,W,L}$ labels to the LS terms provided to them. Finally, the function \codetext{ElectrostaticConfigInteraction} puts them together.

    \foreach \name in {ElectrostaticConfigInteraction}{
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }

\subsection{$\hamSpinSpinSpinOtherOrbitSymbol$: spin-spin and spin-other-orbit}

    The calculation of the $\hamSpinSpinSpinOtherOrbitSymbol$ is qualitatively different from the previous ones. The previous ones were self-contained in the sense that the reduced matrix elements that we require we also computed on our own. In the case of the interactions that follow from here, we use values from literature for reduced matrix elements either in $\forb^2$ or in $\forb^3$ and then we ``pull'' them up for all $\forb^{\numE}$ configuration with the help of formulas involving coefficients of fractional parentage.

    The analysis of spin-other-orbit, and the spin-spin contributions we use in \qlanth is that of Judd, Crosswhite, and Crosswhite \cite{judd_intra-atomic_1968}. If the spin-orbit correction arrived from the influence that the orbital motion of an electron has on its own magnetic moment, the spin-other-orbit reflects the interaction that the motion of one electron has on the magnetic moment of another. Much as the spin-orbit effect can be extracted as a relativistic correction with the Dirac equation as the starting point. The multi-electron spin-orbit effects can be derived from the Breit operator \cite{bethe_quantum_1957} which is added to the relativistic description of a many-particle system in order to account for retardation of the electromagnetic field
    \begin{equation}
    \ham_B = -\frac{1}{2}e^2 \sum_{i>j} \left[ \left(\alpha_i\cdot\alpha_j\right)\frac{1}{r_{ij}} + \left(\alpha_i\cdot{\vec{r}_{ij}}\right)\left(\alpha_j\cdot\vec{r}_{ij}\right) \frac{1}{r_{ij}^3} \right].
    \end{equation}

    When this operator is expanded in powers of $v/c$, a number of non-relativistic inter-electron interactions result. Two of them being the spin-other-orbit and spin-spin interactions.

    As usual, the radial part of the Hamiltonian is averaged, which in this case gives appearance to the Marvin integrals
    \begin{equation} 
    \Mk{k} \DEF \frac{e^2\hbar^2}{8m^2c^2} \braopket{(nl)^2}{\frac{r_<^k}{r_>^{k+3}}}{(nl)^2}
    \end{equation}

    With these, the expression for the spin-spin term is \cite{judd_intra-atomic_1968}
    \begin{multline}
    \ham_{s:s} = -2 \sum_{i\neq{j}}
        \sum_k \Mk{k}
            \sqrt{(k+1)(k+2)(2k+3)} 
            \redbraopket{\lorb}{\Ck{k}}{\lorb} 
            \redbraopket{\lorb}{\Ck{k+2}}{\lorb}
            \left\{
                \wdouble{i}{1}{k}
                \wdouble{j}{1}{k+2}
            \right\}^{(2,2)0}
    \end{multline}
    and the one for spin-other-orbit 
    \begin{multline}
        \ham_{s:oo} = \sum_{i\neq{j}} 
            \sum_k 
                \sqrt{(k+1)(2\lorb+k+2)(2\lorb-k)}  \times \\ 
        \left[ \left\{ \wdouble{i}{0}{k+1} \wdouble{j}{1}{k} \right\}^{(11)0} 
        \left\{ \Mk{k-1}
            \redbraopket{\lorb}
                {\Ck{k+1}}
                {\lorb}^2
            +
            2 \Mk{k} \redbraopket{\lorb}{\Ck{k}}{\lorb}^2
        \right\} + \right. \\
        \left.
            \left\{ \wdouble{i}{0}{k}\wdouble{j}{1}{k+1} \right\}^{(11)0} 
                \left\{ \Mk{k} 
                    \redbraopket{\lorb}{\Ck{k}}{\lorb}^2
                    + 2 \Mk{k-1}
                    \redbraopket{\lorb}{\Ck{k+1}}{\lorb}^2
                \right\}
        \right].
    \end{multline} 

    In the expressions above $\wdouble{i}{\kappa}{k}$ is a double tensor operator of rank $\kappa$ over spin, of rank $k$ over orbit, and acting on electron $i$. It is defined by its reduced matrix elements as
    \begin{equation}
    \redbraopket{\lorb}
        {\wdouble{}{\kappa}{k}}
        {\lorb}
        = \sqrt{\tpobraket{\kappa}
            \tpobraket{k}
        }
    \end{equation} 

    The complexity of the above expressions for can be identified by identifying them with the scalar part of two new double tensors $\Txyz{1}{1}{0}$ and $\Txyz{2}{2}{0}$ such that
    \begin{align}
    \sqrt{5}\Txyz{2}{2}{0} &\DEF \hamSpinSpinSymbol \\
    -\sqrt{3}\Txyz{1}{1}{0} &\DEF \hamSpinOtherOrbitSymbol
    \end{align}

    In terms of which the reduced matrix elements in the $\LSJbasis$ basis can be obtained by
    \begin{equation}
        \braopket{\gamma{SLJ}}{\ham}{\gamma'{S'L'J'}} = \kronecker{J}{J'} \sixj{S'}{L'}{J}{L}{S}{t} \redbraopket{\gamma{SL}}{\Txyz{t}{t}{}}{\gamma'{S'L'}}.
    \label{SLtoSLJ for Ttt}
    \end{equation}

    This above relationship is used in \qlanth in the functions \codetext{SpinSpin} and \codetext{SOOandECSO}.

    \foreach \name in {SpinSpin, SOOandECSO}{
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }

    For two-electron operators such as these, the matrix elements in $\forb^\numE$ are related to those in $\forb^{\numE-1}$ through equation 4 in Judd et al \cite{judd_intra-atomic_1968}
    \begin{multline}
        \redbraopket{\forb^\numE\psi}
        	{\Txyz{t}{t}{}}
        	{\forb^\numE\psi'} 
        = \frac{\numE}{\numE-2} 
        \sum_{\bar{\psi},\bar{\psi}'}
        \phaser{\bar{S}+\bar{L}+\sspin+\lorb+S'+L'}
        \sqrt{\tpobraket{S}\tpobraket{S'}\tpobraket{L}\tpobraket{L'}} \times \\
        \cfpinv{\psi}{\bar{\psi}}
        \cfpinv{\psi'}{\bar{\psi}'} 
        \sixj{S}{t}{S'}{\bar{S}'}{\sspin}{\bar{S}}
        \sixj{L}{t}{L'}{\bar{L}'}{\lorb}{\bar{L}}
        \redbraopket{\forb^{\numE-1}\bar{\psi}}
        {\Txyz{t}{t}{}}{\forb^{\numE-1}]\bar{\psi}'}.
    \label{double cfp escalator}
    \end{multline}
    Where the sum runs over the terms $\bar{\psi}$ and $\bar{\psi}'$ in $\forb^{\numE-1}$ which are parents common to $\psi$ and $\psi'$. Using these the matrix elements of $\Txyz{1}{1}{}$ and $\Txyz{2}{2}{}$ in $\forb^2$ can be used to compute all the reduced matrix elements in  $\forb^\numE$. These could then be used, together with \eqnref{SLtoSLJ for Ttt} to obtain the matrix elements of $\hamSpinSpinSymbol$ and $\hamSpinOtherOrbitSymbol$. This is done for $\hamSpinSpinSymbol$, but not for $\hamSpinOtherOrbitSymbol$, since this term is traditionally computed (with a slight modification) at the same as the electrostically-correlated-spin-orbit (see next section).

    These equations are implemented in \qlanth through the following functions: \codetext{Generate{\-}T22{\-}Table}, \codetext{ReducedT22infn}, \codetext{ReducedT22inf2}, \codetext{ReducedT11inf2}. Where \codetext{ReducedT22inf2} and \codetext{ReducedT11inf2} provide the reduced matrix elements for $\Txyz{1}{1}{}$ and $\Txyz{2}{2}{}$ in $\forb^2$ as provided in table II of \cite{judd_intra-atomic_1968}.

    \foreach \name in {GenerateT22Table, ReducedT22infn, ReducedT22inf2, ReducedT11inf2}{
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }

\subsection{$\hamECSOSymbol$: electrostatically-correlated-spin-orbit and a note about CI}

    In the same paper \cite{judd_intra-atomic_1968} that describes the spin-spin and spin-other-orbits consideration is also given to the emergence of additional corrections due to configuration interaction as described by the following operator (page.  169 of \cite{judd_intra-atomic_1968})
    \begin{equation}
        \ham_{\text{ci}} = -\sum_\chi \sum_i \frac{1}{E_\chi}\xi(r_i) 
            \left(  
                \op{\sspin}_i\cdot\op{\lorb}_i
            \right) \ket{\chi} \bra{\chi} \CoulombNonCentral
            - \frac{1}{E_\chi}\CoulombNonCentral \ket{\chi}\bra{\chi} \xi(r_i) 
                \left( 
                    \op{\sspin}_i\cdot\op{\lorb}_i
                \right) 
    \end{equation} 
    where $\xi(r_h) (\op{\sspin}_h\cdot\op{\lorb}_h)$ is the customary spin-orbit interaction, $E_\chi$ is the energy of state $\ket{\chi}$, $i$ is a label for the valence electrons, and $\ket{\chi}$ are states in the configurations to which one is ``interacting'' with.

    Most importantly in the above, the term $\CoulombNonCentral$ stands for the non-central part of the Coulomb interaction. This serves as a reminder that the central field approximation of single-electron wavefunctions is, indeed, an approximation. The non-central part of the electrostatic field is defined as what remains after subtracting the radial component. This term is crucial to keep in mind because it facilitates parity-breaking transitions, such as forced electric dipole transitions. Moreover, the non-central nature of this term plays a significant role in configuration mixing (see \cite{morrison_many-body_1971}), which is why the operator $\CoulombNonCentral$ is prominently featured in the expression for configuration interaction, and why the modifier ``electrostatically correlated'' is prepended to spin-orbit to form ``electrostatically correlated spin orbit''. It's also worth keeping in mind that the derivation of such an expression is based on second-order perturbation theory.

    This operator can be identified with a it being the scalar component of a double tensor operator of rank 1 both for the spin and orbital parts of the wavefunction. 
    \begin{equation}
        \ham_{\text{ci}} = - \sqrt{3}\,\txyz{1}{1}{0}
    \end{equation}

    Judd \textit{et al.} then go on to list the reduced matrix elements of this operator in the $\forb^2$ configuration. When this is done the Marvin integrals $\Mk{k}$ appear again, but a second set of parameters is also necessary
    \begin{equation}
        \Pk{k} = 6 \sum_{f'}
            \frac{\zeta_{ff'}}
                {E_{ff'}}
                R^{(k)}(ff,ff') \text{ for }k=0,2,4,6.
    \end{equation}
    Where $f$ notes the radial eigenfunction attached to an f-electron wavefunction, and $f'$ similarly but for a configuration different from $\forb^\numE$. And where
    \begin{align}
        \zeta_{ff'} &\DEF \braopket{f}{\xi(r)}{f'} \\
        R^{(k)}(ff,ff') &\DEF e^2 \braopket{f_1f_2}{\frac{r_<^k}{r_>^{k+1}}}{f_1f_2'}.
    \end{align}

    In the semi-empirical approach embodied by $\qlanth$, calculating these quantities \textit{ab initio} is not the objective, rendering the precise definition of these parameters non-essential. Nonetheless, these expressions frequently serve to justify the ratios between different orders of these quantities. Consequently, both the set of three $\Mk{k}$ and the set of $\Pk{k}$ ultimately rely on a single free parameter each. Such parsimony is desirable given the large number of parameters (about 20) that the Hamiltonian ends up having.

    Judd \textit{et al.} further note that $\Pk{0}$ is proportional to the spin orbit operator, and as such its effect is absorbed by the standard spin-orbit parameter $\spinZeta$. They also developed an alternative approach based on group theory arguments. They put together the spin-other-orbit and the electrostatically-correlated-spin-orbit as a sum of operators $\op{z}_i$ with useful transformation rules 
    \begin{equation}
        \redbraopket{\psi}{\Txyz{1}{1}{} + \txyz{1}{1}{}}{\psi'} = \sum a_i \redbraopket{\psi}{\hat{z}_i}{\psi'}.
    \end{equation}

    At this stage a subtle point needs to be raised. As Judd points out, in the sum above, the term $\op{z}_{13}$ that contributes with a tensorial character equal to that of the regular spin-orbit operator. As such, if the goal is obtaining a parametric Hamiltonian that can be fit with uncorrelated parameters, it is then necessary to subtract this part from $\Txyz{1}{1}{} + \txyz{1}{1}{}$. This point was clarified by Chen \textit{et al.} \cite{chen_few_2008}. Because of this the final form of the operator contributing both to spin-other-orbit and the electrostatically-correlated-spin-orbit is:

    \begin{equation}
        \hamSpinOtherOrbitSymbol + \hamECSOSymbol = \Txyz{1}{1}{} + \txyz{1}{1}{} - \frac{1}{6}a_{13}\op{z}_{13}
        \label{SOO ECSO sum}
    \end{equation}
    where
    \begin{equation}
        a_{13} = -33 \Mk{0} + 3 \Mk{2} + 15/11 \Mk{4} - 6 \Pk{0} + 3/2 (35 \Pk{2} + 77 \Pk{4} + 143 \Pk{6})
    \end{equation}

    In \qlanth the contributions from spin-spin, spin-other-orbit, and electrostatically-correlated-spin-orbit are put together by the function \codetext{MagneticInteractions}. That function queries precomputed values from two associations \codetext{SpinSpinTable} and \codetext{SOOandECSOTable}. In turn these two associations are generated by the functions \codetext{GenerateSpinOrbitTable} and \codetext{GenerateSOOandECSOTable}. Note that both spin-spin and spin-other-orbit end up contributing through $\Mk{k}$, however there doesn't seem to be consensus about adding them together, as such \qlanth allows including or excluding the spin-spin contribution, this is done with a control parameter $\sigma_{SS}$ (1 for including, 0 for excluding).

    \foreach \name in {MagneticInteractions, GenerateSpinOrbitTable, GenerateSOOandECSOTable}{
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }

    The function \codetext{GenerateSpinSpinTable} calls the function \codetext{SpinSpin} over all possible combinations of the arguments $\{\numE, SL, S'L', J\}$. In turn the function \codetext{SpinSpin} queries the precomputed values of the the double tensor $\Txyz{2}{2}{}$ which are stored in the association \codetext{T22Table}. 


    \foreach \name in {GenerateSpinSpinTable, SpinSpin}{ 
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }

    The association \codetext{T22Table} is computed by the function \codetext{GenerateT22Table}. This function populates \codetext{T22Table} with keys of the form $\{\numE, SL, S'L'\}$. It does this by using the function \codetext{ReducedT22inf2} in the base case of $\forb^2$, and \codetext{ReducedT22infn} for configurations above $\forb^2$. When \codetext{ReducedT22infn} is called the sum in \eqnref{double cfp escalator} is carried out using $t=2$. When \codetext{ReducedT22inf2} is called the reduced matrix elements from \cite{judd_intra-atomic_1968} are used. 

    \foreach \name in {GenerateT22Table, ReducedT22infn, ReducedT22inf2}{
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }

    The function \codetext{GenerateSOOandECSOTable} calls the function \codetext{SOOandECSO} over all possible combinations of the arguments $\{\numE, SL, S'L', J\}$ and uses their values to populate the association \codetext{SOOandECSOTable}. In turn the function \codetext{SOOandECSO} queries the precomputed values of \eqnref{SOO ECSO sum} as stored in the association \codetext{SOOandECSOLSTable}. 

    \foreach \name in {GenerateSOOandECSOTable, SOOandECSO, SOOandECSO}{
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }

    The association \codetext{SOOandECSOLSTable} is computed by the function \codetext{GenerateSOOandECSOLSTable}. This function populates \codetext{SOOandECSOLSTable} with keys of the form $\{\numE, SL, S'L'\}$. It does this by using the function \codetext{ReducedSOOandECSOinf2} in the base case of $\forb^2$, and \codetext{ReducedSOOandECSOinfn} for configurations above $\forb^2$. When \codetext{ReducedSOOandECSOinfn} is called the sum in \eqnref{double cfp escalator} is carried out using $t=1$. When \codetext{ReducedSOOandECSOinf2} is called the reduced matrix elements from \cite{judd_intra-atomic_1968} are used.

    \foreach \name in {ReducedSOOandECSOinfn, ReducedSOOandECSOinf2}{
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }

\subsection[$\ham_3$: three-body effective operators]{$\ham_{\trispoke}$: three-body effective operators}

Three body model\footnote{\textit{model interactions} are interactions that appear because of the simplifications in our models, they are not fundamental, but originate from them.} interactions arise in the lanthanides due to configuration interaction between configurations $(4\forb)^{\numE}$ and $(4\forb)^{\numE\pm{1}}(n'\lorb')^{\mp{1}}$. As such they describe the effects of configuration interaction of single-electron excitations from the ground configuration to excited ones. 

What results from the configuration interaction analysis (see \cite{rajnak_configuration_1963},\cite{judd_three-particle_1966}, and \cite{judd_complete_1984}, shows that the effective result from the model interaction arising from CI has the form of a three body operator.

These operators were initially studied by Wybourne and Rajnak in 1963 \cite{rajnak_configuration_1963}, their analysis was complemented soon after by \cite{judd_three-particle_1966}, and revisted again by Judd in 1984 \cite{judd_complete_1984}.

This interaction is spanned by a set of 14 $\op{t}_i$ of operators
\begin{equation}
\ham_{\trispoke} = {\opcolor{T'^{(2)}}}\op{t}'_2 + \hamEffectiveThreeBody.
\end{equation}
Where $\hat{t}_2'$ is a fifteenth legacy operator that is needed to reproduce old results from literature. The omission of some indices has to do with the fact that they way in which these are defined, lead to some of them being two-body operators, and as such they are excluded from the sum.

The calculation of a three body operator across the $\forb^{\numE}$ configuration is analogous to how a two-body operator is calculated. Except that in this case what are needed are the reduced matrix elements in $\forb^3$ and the equation that is needed to propagate these across the other configurations is modified accordingly to equation 4 in \cite{judd_three-particle_1966} (adding the explicit dependence on $J$ and $\Msub{J}$):
\begin{equation} 
	\braopket{\forb^{\numE}\psi}
		{\op{t}_i}
		{\forb^{\numE}\psi'} =
		\kronecker{J}{J'}
		\kronecker{\Msub{J}}{\Msub{J}'} 
		\frac{\numE}{\numE-3} 
		\sum_{\bar{\psi}\bar{\psi}'}
			\cfpinv{\psi}{\bar{\psi}}
        	\cfpinv{\psi'}{\bar{\psi}'}
        	\braopket{\forb^{\numE-1}\bar{\psi}}{\op{t}_i}{\forb^{\numE-1}\bar{\psi}'}.
\label{eqn:three body escalator}
\end{equation}

The sum in this expresion runs over the parents in $\forb^{\numE-1}$ that are common to both the daughter terms $\psi$ and $\psi'$ in $\forb^{\numE}$. The equation above yielding LSJMJ matrix elements, and being diagonal in J, MJ as is due to a scalar operator.

In \qlanth this is all implemented in the function \codetext{GenerateThreeBodyTables}. Where the matrix elements in $\forb^3$ are gotten from \cite{judd_complete_1984}, where the data has been digitized in the files \codetext{Judd1984-1.csv} and \codetext{Judd1984-2.csv}, which are parsed through the function \codetext{ParseJudd1984}.
 
 In \codetext{GenerateThreeBodyTables} a special case is made for $\op{t}_2$ and $\op{t}_{11}$ for which primed variants $\op{t}_2'$ and $\op{t}_{11}'$ are calculated differently beyond the half filled shell. In the case of the other operators, beyond $\forb^7$ the matrix elements simply see a global sign flip, whereas in the case of $\op{t}_2'$ and $\op{t}_{11}'$ the coefficients of fractional parentage beyond $\forb^7$ are used. This yields the unexpected result that in the $\forb^{12}$ configuration, which corresponds to two holes, there is a non-zero three body operator $\op{t}_2'$. This is an arcane result that was corrected by Judd in 1984 \cite{judd_complete_1984}, but which lingered long enough that important work in the 1980s was calculated with it. When calculations are carried out if $\op{t}_2'$ is used then $\op{t}_2$ shouln't be used and vice versa.
 
 One additional feature of $\hat{t}_2'$ that needs to be accounted for, is that it doesn't have the simple relationship for conjugate configurations that all the other $\hat{t}_i$ operators have. For the sake of parsimony, and avoid having to explicitly store matrix elements beyond $f^7$ \qlanth takes the approach of adding a control parameter \codetext{t2Switch} which needs to be set to 1 if below or at $\forb^7$ and set to 0 if above $\forb^7$.
 
 \foreach \name in {GenerateThreeBodyTables, ParseJudd1984}{ 
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }
 
\subsection{$\hamCrystalFieldSymbol$: crystal-field} 

	The crystal-field partially accounts for the influence of the surrounding lattice on the ion. The simplest picture of this influence imagines the lattice as reponsible for an electric field felt at the position of the ion. This electric field corresponding to an electrostatic potential described as a multipolar sum of the form:  
    \begin{equation}   
    V(r_i, \theta_i, \phi_i) = \sum_{k=1}^\infty \sum_{q=-k}^k \Akq r^k \Ckq{k}{q}(\theta_i, \phi_i) 
    \end{equation}  

    Where we have chosen a coordinate system with its origin at the position of the nucleus, and in which we only have positive powers of the distance $r_i$ since here we have expanded the contributions from all the surrounding ions as a sum over spherical harmonics centered at the position of the nucleus, without $r$ ever large enough to reach any of the positions of the lattice ions. 

    Furthermore, since we have $\numE$ valence electrons, then the total crystal field potential is 
    \begin{equation}
        \hamCrystalFieldSymbol(\vec{r}) = 
        	\sum_{i=1}^\numE
        	\sum_{k=0}^\infty
        	\sum_{q=-k}^{k} \Akq r_i^k \Ckq{k}{q}(\theta_i,\phi_i).
    \label{eqn:crystal sum}
    \end{equation}

    And if we average the radial coordinate,
    \begin{equation}
        \hamCrystalFieldSymbol = \sum_{i=1}^\numE \sum_{k=1}^\infty \sum_{q=-k}^{k} \Bcomplexkq{k}{q} {\Ckq{k}{q}}\!(i) 
    \end{equation}
    where the radial average is included as
    \begin{equation}
    \Bcomplexkq{k}{q} \DEF \Akq {\langle r^k \rangle}.
    \end{equation}
    
    $\Bcomplexkq{k}{q}$ may be complex in general. However, since the sum in \eqnref{eqn:crystal sum} needs to result in a real and Hermitian operator, there are restrictions on $\Bcomplexkq{k}{q}$ that need to be accounted for. Once the behaviour of $\Ckq{k}{q}$ under complex conjugation is considered it is seen that
    \begin{equation}
    	\Bcomplexkq{k}{q} = \phaser{q}\Bcomplexkq{k}{-q}^{*}.
    \end{equation}
    
    Presently the sum over $q$ spans both its negative and positive values. This can be limited to only the non-negative values of $q$. Separating the real and imaginagy parts of $\Bcomplexkq{k}{q}$ such that $\Bcomplexkq{k}{q} = \Bkq{k}{q} + i \Skq{k}{q}$ for $q\neq{0}$ and $\Bcomplexkq{k}{0} = 2\Bkq{k}{0}$ the sum for the crystal field can then be written as
    \begin{equation}
        \hamCrystalFieldSymbol(\vec{r}) = 
        	\sum_{i=1}^\numE
        	\sum_{k=0}^\infty
        	\sum_{q=0}^{k} \Bkq{k}{q} \left(\Ckq{k}{q} + \phaser{q}\Ckq{k}{-q}\right) + i \Skq{k}{q} \left(\Ckq{k}{q} - \phaser{q}\Ckq{k}{-q}\right).
    \label{eqn:better crystal sum}
    \end{equation}
    
    A staple of the Wigner-Racah algebra is writing up operators on interest in terms of standard ones for which the matrix elements are straightforward.  One such operator is the unit tensor operator $\hat{u}^{(k)}$ for a single electron. The Wigner-Eckart theorem --on which all of this algebra is an elaboration-- effectively separates the dynamical and geometrical parts of a given interaction; the unit tensor operators isolate the geometric contributions. This irreducible tensor operator $\hat{u}^{(k)}$ is defined as the tensor operator having the following reduced matrix elements (written in terms of the triangular delta, see section on notation):
    \begin{equation}
    \redbraopket{\ell}{\hat{u}^{(k)}}{\ell'} = 1.
    \end{equation}

    In terms of this tensor one may then define the symmetric (in the sense that the resulting operator is equitable among all electrons) unit tensor operator for $\numE$ particles as
    \begin{equation}
        \hat{U}^{(k)} = \sum_{i}^{\numE} \op{u}^{(k)}_i.
    \end{equation}

    This tensor is relevant to the calculation of the above matrix elements since 
    \begin{equation}
        \Ckq{k}{q} = \redbraopket{\lorb}
                    {\Ck{k}}
                    {\lorb{'}} \op{u}^{(k)}_q 
            = \phaser{\lorb}
            \sqrt{\tpobraket{\lorb}\tpobraket{\lorb{'}}}
            \threej{\lorb}{k}{\lorb'}{0}{0}{0} \op{u}^{(k)}_q.
    \end{equation}

    With this the matrix elements of $\hamCrystalFieldSymbol$ in the $\LSJMbasis$ basis are: 
    \begin{align}
        \overbracket{\braopket{\lorb^\numE \alpha SLJ \Msub{J}}{\hamCrystalFieldSymbol}{\lorb^\numE \alpha'S L' J' \Msub{J'}}}^{\text{Wybourne eqn. 6-3}} &= \sum_{k=1}^\infty\sum_{q=-k}^k    
        \Bcomplexkq{k}{q} 
            \braopket{\lorb^\numE \alpha SLJ\Msub{J}}
                {\op{U}^{(k)}_q}
                {\lorb^\numE \alpha'SL'J'\Msub{J'}} 
            \redbraopket{\lorb}
                {\op{C}^{(k)}}
                {\lorb} 
    \label{HCFsum}
    \end{align}

    where the matrix elements of $\op{U}^{(k)}_q$ can be resolved with a 3j symbol as
    \begin{align}
        \overbracket{\braopket{\lorb^\numE \alpha S L J \Msub{J}}
            {\op{U}^{(k)}_q}
            {\lorb^\numE \alpha' S' L' J' \Msub{J'}}}^
            {\text{Wybourne eqn. 6-4}}
            &= 
            \phaser{J-\Msub{J}}
            \threej{J}{k}{J'}
                {-\Msub{J}}{q}{\Msub{J'}}
        \redbraopket{\lorb^\numE \alpha S L J}
                {\op{U}^{(k)}}
                {\lorb^\numE \alpha' S' L'}
    \end{align}
    and reduced a second time with the inclusion of a 6j symbol resulting in
    \begin{align}
        \nonumber \overbracket{\redbraopket{\lorb^\numE \alpha S L J}
            {\op{U}^{(k)}}
            {\lorb^\numE \alpha' S' L'}}^
            {\text{Wybourne eqn. 6-5}}
        &= 
        \phaser{S+L+J'+k} 
        \sqrt{\tpobraket{J}\tpobraket{J'}} \times \\
        & \sixj{J}{J'}{k}{L'}{L}{S}
        \redbraopket{\lorb^\numE \alpha S L}
            {\op{U}^{(k)}}
            {\lorb^\numE \alpha' S' L'}.
    \end{align}

    This last reduced matrix element is finally computed with a sum over $\bar{\alpha}\bar{L}\bar{S}$ which are the parents in configuration $\forb^{\numE-1}$ which are common to $\ket{\alpha L S}$ and $\ket{\alpha' L' S'}$ from configuration $\forb^{\numE}$:
    \begin{multline}
    \overbracket{\redbraopket{\lorb^\numE \alpha S L} 
        {\op{U}^{(k)}}
        {\lorb^\numE \alpha' S' L'}}^{\text{Cowan eqn. 11.53}} = \kronecker{S}{S'} \numE \phaser{\lorb + L + k}
            \sqrt{\tpobraket{L}\tpobraket{L'}} \times \\
    \sum_{\bar{\alpha}\bar{L}\bar{S}} 
        \phaser{\bar{L}} \sixj{\lorb}{k}{\lorb}{L}{\bar{L}}{L'}
        \cfpinv{\lorb^\numE \alpha L S}
            {\lorb^{\numE - 1}\bar{\alpha}\bar{L}\bar{S}}
        \cfp{\lorb^{\numE -1}\bar{\alpha}\bar{L}\bar{S}}{\lorb^\numE\alpha'L'S'}.
    \label{eqn:ReducedUk}
    \end{multline}

    From the $\redbraopket{\lorb}{\op{C}^{(k)}}{\lorb}$, and given that we are using $\lorb = \forb = 3$ we can see that by the triangular condition $\tricondition{3,k,3}$ the non-zero contributions only come from $k=0,1,2,3,4,5,6$. An additional selection rule on $k$ comes from considerations of parity. Since both the bra and the ket in $\braopket{\lorb^\numE \alpha SLJ \Msub{J}}{\hamCrystalFieldSymbol}{\lorb^\numE \alpha'S L' J' \Msub{J'}}$ have the same parity, then the overall parity of the braket is determined by the parity of $\Ckq{k}{q}$, and since the parity of $\Ckq{k}{q}$ is $\phaser{k}$ then for the braket to be non-zero we require that $k$ should also be even. In view of this, in all the above equations for the crystal field the values for $k$ should be limited to $2,4,6$. The value of $k=0$ having been omitted from the start since this only contributes a common energy shift. Putting everything together:
       	\begin{equation}
        \hamCrystalFieldSymbol(\vec{r}) = 
        	\sum_{i=1}^\numE
        	\sum_{k=2,4,6}
        	\sum_{q=0}^{k} \Bkq{k}{q} \left(\Ckq{k}{q} + \phaser{q}\Ckq{k}{-q}\right) + i \Skq{k}{q} \left(\Ckq{k}{q} - \phaser{q}\Ckq{k}{-q}\right).
    	\label{eqn:supreme crystal sum}
    	\end{equation}

    The above equations are implemented in \qlanth by the function \codetext{CrystalField}. This function puts together the symbolic sum in \eqnref{HCFsum} by using the function \codetext{Cqk}. \codetext{Cqk} then uses the diagonal reduced matrix elements of $\Ckq{k}{q}$ and the precomputed values for \codetext{Uk} (stored in \codetext{ReducedUkTable}).

    The required reduced matrix elements of $\hat{U}^{(k)}$ are calculated by the function \codetext{ReducedUk}, which is used by \codetext{GenerateReducedUkTable} to precompute its values.
    
\foreach \name in {Bqk, Sqk, Cqk, CrystalField, ReducedUk}{ 
        \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
    }


\subsection{$\hat{\mu}$ and $\hamZeemanSymbol$: the magnetic dipole operator and the Zeeman term}

In atomic units, the operator associated with the magnetic dipole is
\begin{equation}
\hat{\mu} = -\muBohr \left(\op{L} + g_s\op{S} \right)^{(1)}, \text{with }\muBohr=1/2.
\end{equation}
Here we have emphasized the fact that the magnetic dipole operator corresponds to a rank-1 spherical tensor operator.

In the $\LSJMbasis$ basis that we use in \qlanth the LSJ reduced-matrix elements are computed using equation 15.7 in \cite{cowan_theory_1981}
\begin{multline}
    \redbraopket{\alpha{LSJ}}
        {\left(\op{L} + g_s \op{S}\right)^{(1)}}
        {\alpha'{L'S'J'}} =
    \kronecker{\alpha{LSJ}}
        {\alpha'{L'S'J'}}
    \sqrt{J(J+1)(2J+1)} + \\
    \kronecker{\alpha{LS}}
        {\alpha'{L'S'}}
    \phaser{L+S+J+1}
    \sqrt{\tpobraket{J}\tpobraket{J}}
    \sixj{L}{S}{J}{1}{J'}{S}
\end{multline}

And then those reduced matrix elements are used to resolve the $\Msub{J}$ components for $q=-1,0,1$ through Wigner-Eckart  
\begin{multline}
    \braopket{\alpha{LSJ}\Msub{J}}
        {\left(\op{L} + g_s \op{S}\right)^{(1)}_q}
        {\alpha'{L'S'J'}\Msub{J'}} = \\
    \phaser{J-\Msub{J}}
    \threej{J}{1}{J'}{-\Msub{J}}{q}{\Msub{J}'}
    \redbraopket{\alpha{LSJ}}
        {\left(\op{L} + g_s \op{S}\right)^{(1)}}
        {\alpha'{L'S'J'}} 
\end{multline} 
These two above are put together in \codetext{JJBlockMagDip} for given $\{\numE, J, J'\}$ returning a rank-3 array representing the quantities $\{\Msub{J},\Msub{J}',q\}$.

\foreach \name in {JJBlockMagDip}{
    \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
}

The $JJ'$ blocks that are generated with this function are then put together by \codetext{MagDipoleMatrixAssembly} into the final matrix form and the cartesian components calculated according to 
\begin{align}
	\op{\mu}_x &= \frac{\op{\mu}^{(1)}_{-1} - \op{\mu}^{(1)}_{+1}}{\sqrt{2}} \\
	\op{\mu}_y &= i\frac{\op{\mu}^{(1)}_{-1} + \op{\mu}^{(1)}_{+1}}{\sqrt{2}} \\
	\op{\mu}_z &= \op{\mu}^{(1)}_{0}
\end{align}

\foreach \name in {MagDipoleMatrixAssembly}{
    \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
}

Using the cartesian components of the magnetic dipole operator, the matrix elements of the Zeeman term can then be evaluated. This term can be included in the Hamiltonian through an option in \codetext{HamMatrixAssembly}. Since the magnetic dipole operator is calculated in atomic units, and it seeming desirable that the input units of the magnetic field be Tesla, a conversion factor is included so that the final terms be congruent with the energy units assumed in the other terms in the Hamiltonian, namely the pseudo-energy unit Kayser ($\text{cm}^{-1}$). The conversion factor is called \codetext{TestaToKayser} in the file \codetext{qonstants.m}.

\subsection[Going beyond $f^7$]{Going beyond $f^7$}

In most cases all matrix elements in \qlanth are only calculated up to and including $\forb^7$. Beyond $\forb^7$ adequate changes of sign are enforced to take into account the equivalence that can be made between $\forb^{\numE}$ and $\forb^{14-\numE}$. This is enforced when the function \codetext{HamMatrixAssembly} is called. In there \codetext{HoleElectronConjugation} is the function responsible for enforcing a global sign flip for the following operators (or equivalently to their accompanying coefficients):
\begin{equation}
\spinZeta, \Tk{2}, \Tk{3}, \Tk{4}, \Tk{6}, \Tk{7}, \Tk{8}, \Bkq{k}{q}	
\label{eqn:flipped}
\end{equation}

\foreach \name in {HoleElectronConjugation}{
    \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
}

\section{Magnetic Dipole Transitions}

\qlanth can also calculate magnetic dipole transitions. With $\hat{\mu} = \{\hat{\mu}_x, \hat{\mu}_y, \hat{\mu}_z\}$ the magnetic dipole operator, the line strength between two eigenstates $\ket{\nu}$ and $\ket{\nu'}$ is defined as (see for example equation 14.31 in \cite{cowan_theory_1981})
\begin{equation}
	\braopket{\nu}{\lineStrength}{\nu'} \DEF \left| \braopket{\nu}{\hat{\mu}}{\nu'} \right|^2 = \left| \braopket{\nu}{\hat{\mu}_x}{\nu'} \right|^2 + \left| \braopket{\nu}{\hat{\mu}_y}{\nu'} \right|^2 + \left| \braopket{\nu}{\hat{\mu}_z}{\nu'} \right|^2
\end{equation}

In \qlanth this is computed with the function \codetext{MagDipLineStrength}, which given a set of eigenvectors computes the sum above, and returns an array that contains all possible pairings of $\ket{\nu}$ and $\ket{\nu'}$.

\lstinputlisting[language=Mathematica]{./fundefs/MagDipLineStrength.tex}


To this end are the functions \codetext{MagDipLineStrength}, \codetext{MagDipoleRates}, and \codetext{GroundStateOscillatorStrength}.

\foreach \name in {MagDipLineStrength, MagDipoleRates, GroundStateOscillatorStrength}{
    \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
}

\section{Accompanying notebooks}
\qlanth is accompanied by the following auxiliary Mathematica notebooks:

\begin{itemize}
	\item \codetext{qlanth.nb}: gives an overview of the different included functions.
	\item \codetext{qlanth - Table Generator.nb}: generates the basic tables on which every calculation is based.
	\item \codetext{qlanth - JJBlock Calculator.nb}: can be used to generate the JJ blocks for the different interactions. The data files produced here are necessary for \codetext{HamMatrixAssembly} to work.
	\item \codetext{The Lanthanides in LaF3.nb}: runs \qlanth over the lanthanide ions in LaF3 and compares the results agains the published values from Carnall. It also calculates magnetic dipole transition rates and oscillator strengths.
\end{itemize}

\section{Additional data}

\subsection{Carnall et al data on Ln:LaF3}

The study of Carnall et al \cite{carnall_systematic_1989} on lanthanum fluoride was a systematic review of trivalent lanthanide ions in LaF3. In this work they fitted the experimental data for all of the lanthanide ions using the single-configuration effective Hamiltonian. In their appendices one can find their calculated values, together with the experimental values that they used for their least squares fittings. In \qlanth this data can be accesed by invoking the command \codetext{LoadCarnall} which brings into the session an Association that has keys that have as values the tables and appendices from this article. Additionally the function \codetext{LoadParameters} can be used to query the data for the fitted parameters, which may serve as a useful starting point for the description of the lanthanides ions in hosts other than LaF3.

\foreach \name in {Carnall, LoadCarnall, LoadParameters}{
    \lstinputlisting[language=Mathematica]{./fundefs/\name.tex}
}

\subsection{\codetext{sparsefn.py}}

	\qlanth is also accompanied by seven Python scripts \codetext{sparsef[1-7].py}. Each of these contains a single function \codetext{effective\_hamiltonian\_f[1-7]} which returns a sparse array for given values for the model parameters.
	
	There is an eight Python script called \codetext{basisLSJMJ.py} which contains a dictionary whose keys are f1, f2, f3, f4, f5, f6, and f7, and whose values are lists that contain the ordered basis in which the array produced by the \codetext{sparsefn.py} should be understood to be in. Each basis vector is a list with three elements \{LS string in NK notation, $J$, $\Msub{J}$\}.

	In those it is left up to the user to make the adequate change of signs in the parameters for configurations above $\forb^7$.  These include changing the signs of all in \eqnref{eqn:flipped} and setting \codetext{t2Switch} to 0. For configurations at or below $\forb^7$ it is necessary to set \codetext{t2Switch} to 1.

\section{Units}

All of the matrix elements of the Hamiltonian are calculated using the Kayser ($\text{K} \equiv \text{cm}^{-1}$) as the (pseudo) energy unit. All the parameters (except the magnetic field which is in Tesla) in the effective Hamiltonian are assumed to be in this unit. As is customary, the angular momentum operators assume atomic units in which $\hbar=1$.

Some constants and conversion values are included in the file \codetext{qonstants.m}.

\lstinputlisting[language=Mathematica]{../qonstants.m}

\section{Notation}

\begin{gather}
    \overbracket{\,\,\,\,\,\op{l}\,\,\,\,\,}^{\text{orbital angular momentum operator of a single electron}} \\
    \overbracket{\,\,\op{L}\,\,}^{\text{total orbital angular momentum  operator}} \\
    \overbracket{\,\,\op{s}\,\,}^{\text{spin angular momentum  operator of a single electron}} \\
    \overbracket{\,\,\op{S}\,\,}^{\text{total spin angular momentum operator}} \\
    \overbracket{\,\,\Lambda\,\,}^{\text{Shorthand for all other quantum numbers}} \\ 
    \overbracket{\,\,\lorb\,\,}^{\text{orbital angular momentum number}} \\
    \overbracket{\,\,\sspin\,\,}^{\text{spinning angular momentum number}} \\
    \overbracket{\,\,\CoulombNonCentral\,\,}^{\text{Coulomb non-central potential}} \\
    \overbracket{\redbraopket{\Lambda LS}{\op{O}}{\Lambda' L'S'}}^{\text{LS-reduced matrix element of operator }\hat{O}\text{ between }{\Lambda LS} \text{ and } {\Lambda' L'S'}} \\
    \overbracket{\redbraopket{\Lambda LSJ}{\op{O}}{\Lambda' L'S'J'}}^{\text{LSJ-reduced matrix element of operator }\hat{O}\text{ between }{\Lambda LSJ} \text{ and } {\Lambda' L'S'J'}} \\
    \overbracket{\LSterm{2 S + 1}{\alpha{L}}\equiv \ket{\alpha{LS}}}^{\text{Spectroscopic term } {\alpha{LS}} \text{ in Russel-Saunders notation }} \\
    \overbracket{\op{X}^{(k)}}^{\text{spherical tensor operator of rank k}} \\
    \overbracket{\op{X}_q^{(k)}}^{\text{q-component of the spherical tensor operator }\op{X}^{(k)}} \\
    \overbracket{\cfp{\lorb^{n-1}\alpha'L'S'}{\lorb^n\alpha{L}{S}}}^{\text{The coefficient of fractional parentage from the parent term }\ket{\lorb^{n-1}\alpha'{L'S'}}\text{ for the daughter term }\ket{\lorb^{n}\alpha{LS}}}  
\end{gather}



\section{Definitions}  

\begin{gather} 
    \overbracket{\tpobraket{x} \DEF 2x+1}^{\text{two plus one}} \\
    \overbracket{\op{u}^{(k)}}^{\text{irreducible unit tensor operator of rank k}} \\ 
    \overbracket{\op{U}^{(k)} \DEF \sum_{i=1}^{n} \op{u}^{(k)} }^{\text{symmetric unit tensor operator for n equivalent electrons}} \\
    \overbracket{\Ckq{k}{q} \DEF \sqrt{\frac{4\pi}{2k+1}} \Ykq}^{\text{Renormalized spherical harmonics}} \\
    \overbracket{\tricondition{j_1,j_2,j_3} \DEF
    \begin{cases} 
        1 & \text{if } j_1 = (j_2 + j_3), (j_2 + j_3 - 1), \ldots, |j_2-j_3|\\
        0 & \text{otherwise}
        \end{cases}}^{\text{Triangle ``delta'' between $j_1,j_2,j_3$}} 
\end{gather}

\newpage

\section{code}

\subsection{qlanth.m}

This file encapsulates the main functions in \qlanth and contains all the Physics related functions.

\lstinputlisting[language=Mathematica]{../qlanth.m}

\subsection{qonstants.m} 

This file has a few constants and conversion factors.

\lstinputlisting[language=Mathematica]{../qonstants.m}

\subsection{qplotter.m}

This module has a few useful plotting routines.

\lstinputlisting[language=Mathematica]{../qplotter.m}

\subsection{misc.m}

This module includes a few functions useful for data-handling.

\lstinputlisting[language=Mathematica]{../misc.m}

\subsection{qalculations.m}

This script encapsulates example calculations in which the level structure and magnetic dipole transitions are calculated for the lanthanide ions in lanthanum flouride.

\lstinputlisting[language=Mathematica]{../qalculations.m}

\newpage

\printbibliography

\end{document} 
